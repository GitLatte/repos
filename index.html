<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>CloudStream Eklenti Listesi</title>
    <style>
        body { 
    font-family: Arial, sans-serif; 
    margin: 20px; 
    background-color: #f5f5f5; 
    text-align: center; 
}
h2 { color: #333; }

.stats { 
    font-size: 18px; 
    font-weight: bold; 
    margin-bottom: 10px; 
}

.filter-container { margin-bottom: 10px; }
select, input { 
    padding: 6px; 
    font-size: 14px; 
    border-radius: 4px; 
    border: 1px solid #ccc; 
    margin: 4px; 
}
button { 
    padding: 6px; 
    font-size: 14px; 
    border-radius: 4px; 
    background: #007BFF; 
    color: white; 
    border: none; 
    cursor: pointer; 
    transition: 0.3s ease; 
}
button:hover { background: #0056b3; }

/* Tablo için şık ve modern tasarım */
table { 
    width: 95%; 
    border-collapse: separate; 
    border-spacing: 0; 
    margin: auto; 
    background: white; 
    border-radius: 10px; 
    overflow: hidden; 
    border: 2px solid #007BFF; /* Tablo kenarlığını belirginleştirdik */
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1); /* Hafif gölge ekledik */
}

th, td { 
    border: 1px solid #ccc; 
    padding: 10px; 
    text-align: left; 
    font-size: 14px; 
}
th { 
    background-color: #007BFF; 
    color: white; 
    font-size: 15px; 
    border-bottom: 2px solid #0056b3; /* Daha belirgin alt kenar */
}
tr:hover { 
    background-color: #f9f9f9; /* Hover efekti biraz daha yumuşak */
    transition: 0.2s ease-in-out;
}

.bold { font-weight: bold; }
.desc { font-size: 12px; color: #555; }

/* Depo kodları için renkli badge */
.repo-badge {
    display: inline-block;
    font-size: 12px;
    padding: 5px 8px;
    border-radius: 6px;
    margin-right: 4px;
    color: white;
    font-weight: bold;
    box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2); /* Hafif gölge */
}

/* Her repo için özel renkler */
.repo-sinetech { background-color: #FF5733; }  /* Turuncu */
.repo-nikstream { background-color: #33B5E5; } /* Mavi */
.repo-feroxxcs3 { background-color: #FF9800; } /* Açık Turuncu */
.repo-makoto { background-color: #4CAF50; }  /* Yeşil */
.repo-kekikdevam { background-color: #673AB7; } /* Mor */
.repo-kekikan { background-color: #E91E63; } /* Pembe */
.repo-sarapcanagii { background-color: #607D8B; } /* Gri */

/* Ana başlığı şık hale getirme */
.header-title {
    font-size: 28px;
    font-weight: bold;
    color: #007BFF;
    text-align: center;
    margin-bottom: 20px;
    text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.15);
}

/* İstatistikler için özel kart tasarımı */
.stats-container {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 20px;
}

.stats-card {
    background-color: #ffffff;
    padding: 12px 20px;
    border-radius: 8px;
    border: 2px solid #007BFF;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
    font-size: 16px;
    font-weight: bold;
    color: #333;
    min-width: 240px;
    text-align: center;
    transition: 0.3s ease-in-out;
}

.stats-card:hover {
    background-color: #007BFF;
    color: white;
    transform: scale(1.05);
}

    </style>    
</head>
<body>
    <h2 class="header-title">CloudStream Eklenti Listesi</h2>

<div class="stats-container">
    <div class="stats-card"><span id="totalPlugins">Eklenti Sayısı: 0</span></div>
    <div class="stats-card"><span id="totalRepos">Depo Sayısı: 0</span></div>
</div>


    <div class="filter-container">
        <label for="filterSelect">Medya Türü Seç:</label>
        <select id="filterSelect">
            <option value="all">Tüm Eklentiler</option>
        </select>

        <label for="repoFilterSelect">Depo Seç:</label>
        <select id="repoFilterSelect">
            <option value="all">Tüm Depolar</option>
        </select>
    </div>

    <div class="filter-container">
        <input type="text" id="searchInput" placeholder="Eklenti Ara...">
        <button id="clearSearch">Temizle</button>
    </div>

    <table id="pluginTable">
        <thead>
            <tr>
                <th>İkon</th>
                <th>Ad</th>
                <th>Depo Kodu</th>
                <th>Tür</th>
                <th>Açıklama</th>
                <th>Dil</th>
                <th>Ver.</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>

        function fetchPlugins() {
        fetch("https://GitLatte.github.io/repos/data.json") // Eski sistem geri döndü!
        .then(response => response.json())
        .then(data => {
        window.pluginData = data; // Güncellenmiş veriyi sakla
        updateStats("all");       // Toplam eklenti ve depo bilgilerini güncelle
        updateFilterOptions();    // Medya türü seçeneklerini güncelle
        updateRepoOptions();      // Depo seçeneklerini güncelle
        updateTable("all", "all", ""); // Tabloyu güncellenmiş verilerle yenile
         })
        .catch(error => console.error("JSON verisi yüklenemedi:", error));
         }

         function updateStats(selectedRepo = "all") {
    const totalPlugins = window.pluginData.length;
    const totalRepos = new Set(window.pluginData.map(plugin => plugin.repositoryUrl)).size;
    let selectedRepoCount = 0;
    let selectedRepoName = "Bilinmiyor"; 

    if (selectedRepo !== "all") {
        const selectedPlugins = window.pluginData.filter(plugin => plugin.repoCodes.includes(selectedRepo));
        selectedRepoCount = selectedPlugins.length;

        if (selectedPlugins.length > 0) {
            selectedRepoDisplay = selectedRepo === "sinetech" ? "Latte veya sinetech" : selectedRepo;
        }
    }

    // İstatistikleri doğrudan güncelleyelim!
    document.getElementById("totalPlugins").textContent = selectedRepo === "all" ? `Toplam Eklenti: ${totalPlugins}` : `Bu Depodaki Eklenti Sayısı: ${selectedRepoCount}`;
    document.getElementById("totalRepos").textContent = selectedRepo === "all" ? `Toplam Depo: ${totalRepos}` : `Depo Kodu: ${selectedRepoDisplay}`;
}



        function updateFilterOptions() {
            const filterSelect = document.getElementById("filterSelect");
            let mediaTypes = new Set();
            window.pluginData.forEach(plugin => plugin.tvTypes.forEach(type => mediaTypes.add(type)));

            filterSelect.innerHTML = '<option value="all">Tüm Eklentiler</option>';
            mediaTypes.forEach(type => {
                let option = document.createElement("option");
                option.value = type;
                option.textContent = type;
                filterSelect.appendChild(option);
            });
        }

        function updateRepoOptions() {
    const repoFilterSelect = document.getElementById("repoFilterSelect");
    let repositories = new Set();
    let repoNames = new Map();
    
    window.pluginData.forEach(plugin => {
        if (plugin.repoCodes) {
            plugin.repoCodes.forEach(repo => {
                repositories.add(repo);
                repoNames.set(repo, repo === "sinetech" ? "Latte / sinetech" : repo);
            });
        }
    });

    repoFilterSelect.innerHTML = '<option value="all">Tüm Depolar</option>';
    repositories.forEach(repo => {
        let option = document.createElement("option");
        option.value = repo;
        option.textContent = repoNames.get(repo) || "Bilinmiyor";
        repoFilterSelect.appendChild(option);
    });
}


function updateTable(filterType, repoFilter, searchQuery) {
    const tableBody = document.querySelector("#pluginTable tbody");
    tableBody.innerHTML = "";

    // CloudStream medya türlerini Türkçeleştirme tablosu
    const mediaTypeTranslations = {
        "podcast": "Podcast",
        "tvseries": "Dizi",
        "anime": "Anime",
        "ova": "OVA (Özel Video Animasyon)",
        "cartoon": "Çizgi Film",
        "documentary": "Belgesel",
        "short": "Kısa Film",
        "music": "Müzik",
        "live": "Canlı Yayın",
        "nsfw": "Yetişkin İçeriği",
        "others": "Diğer",
        "asiandrama": "Asya Dizisi",
        "animemovie": "Anime Filmi",
        "animeova": "Anime",
        "movie": "Film"
    };

    window.pluginData.forEach(plugin => {
        if (filterType !== "all" && !plugin.tvTypes.includes(filterType)) return;
        if (repoFilter !== "all" && !plugin.repoCodes.includes(repoFilter)) return;
        if (searchQuery && !plugin.name.toLowerCase().includes(searchQuery.toLowerCase())) return;

        // Harf duyarlılığını kaldırarak medya türlerini Türkçeleştirelim
        const translatedTypes = plugin.tvTypes.map(type => mediaTypeTranslations[type.toLowerCase()] || type).join(", ");

        // Repo kodlarını şık badge formatında gösterelim
        const repoBadges = plugin.repoCodes.map(repo => `<span class="repo-badge repo-${repo}">${repo}</span>`).join(" ");

        // Eğer eklenti NSFW ise ismi sansürle
        const pluginNameFormatted = plugin.tvTypes.includes("NSFW") ? "****" : plugin.name;

        // Eğer eklenti NSFW ise açıklama sabit yazı olacak
        const pluginDescriptionFormatted = plugin.tvTypes.includes("NSFW") ? "Kullandığınız depo içerisinden kontrol ediniz" : (plugin.description || "Açıklama Yok");

        const row = document.createElement("tr");
        row.innerHTML = `
            <td><img src="${plugin.iconUrl.replace('%size%', '64')}" width="28"></td>
            <td class="bold">${pluginNameFormatted}</td>
            <td>${repoBadges}</td>
            <td>${translatedTypes}</td> 
            <td class="desc">${pluginDescriptionFormatted}</td>
            <td>${plugin.language}</td>
            <td>${plugin.version}</td>
        `;
        tableBody.appendChild(row);
    });
}
        
        // Event Listener'ları ekleyelim
        document.getElementById("filterSelect").addEventListener("change", function() {
            const repoFilter = document.getElementById("repoFilterSelect").value;
            const searchQuery = document.getElementById("searchInput").value;
            updateTable(this.value, repoFilter, searchQuery);
        });

        document.getElementById("repoFilterSelect").addEventListener("change", function() {
    const selectedRepo = this.value; // Seçilen depo değerini al
    updateStats(selectedRepo);       // Hatasız şekilde fonksiyona gönder
    const filterType = document.getElementById("filterSelect").value;
    const searchQuery = document.getElementById("searchInput").value;
    updateTable(filterType, selectedRepo, searchQuery);
});


        document.getElementById("searchInput").addEventListener("input", function() {
            const filterType = document.getElementById("filterSelect").value;
            const repoFilter = document.getElementById("repoFilterSelect").value;
            updateTable(filterType, repoFilter, this.value);
        });

        document.getElementById("clearSearch").addEventListener("click", function() {
            document.getElementById("searchInput").value = "";
            const filterType = document.getElementById("filterSelect").value;
            const repoFilter = document.getElementById("repoFilterSelect").value;
            updateTable(filterType, repoFilter, "");
        });

        fetchPlugins();
    </script>
</body>
</html>
