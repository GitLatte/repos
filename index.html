<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>CloudStream Eklenti Listesi</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; text-align: center; }
        h2 { color: #333; }
        .stats { font-size: 18px; font-weight: bold; margin-bottom: 15px; }
        .filter-container { margin-bottom: 15px; }
        select, input { padding: 8px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; margin: 5px; }
        button { padding: 8px; font-size: 16px; border-radius: 5px; background: #007BFF; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 8px; overflow: hidden; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
        th { background-color: #007BFF; color: white; }
        tr:hover { background-color: #f1f1f1; }
    </style>
</head>
<body>
    <h2>CloudStream Eklenti Listesi</h2>

    <div class="stats" id="statsContainer">
        <span id="totalPlugins">Toplam Eklenti: 0</span> | 
        <span id="totalRepos">Toplam Depo: 0</span>
    </div>    

    <div class="filter-container">
        <label for="filterSelect">Medya Türü Seç:</label>
        <select id="filterSelect">
            <option value="all">Tüm Eklentiler</option>
        </select>

        <label for="repoFilterSelect">Depo Seç:</label>
        <select id="repoFilterSelect">
            <option value="all">Tüm Depolar</option>
        </select>
    </div>

    <div class="filter-container">
        <input type="text" id="searchInput" placeholder="Eklenti Ara...">
        <button id="clearSearch">Temizle</button>
    </div>

    <table id="pluginTable">
        <thead>
            <tr>
                <th>İkon</th>
                <th>Ad</th>
                <th>Versiyon</th>
                <th>Dil</th>
                <th>Depo Kodu</th>
                <th>Tür</th>
                <th>Açıklama</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>

        function fetchPlugins() {
        fetch("https://GitLatte.github.io/repos/data.json") // Eski sistem geri döndü!
        .then(response => response.json())
        .then(data => {
        window.pluginData = data; // Güncellenmiş veriyi sakla
        updateStats("all");       // Toplam eklenti ve depo bilgilerini güncelle
        updateFilterOptions();    // Medya türü seçeneklerini güncelle
        updateRepoOptions();      // Depo seçeneklerini güncelle
        updateTable("all", "all", ""); // Tabloyu güncellenmiş verilerle yenile
         })
        .catch(error => console.error("JSON verisi yüklenemedi:", error));
         }

        function updateStats(selectedRepo) {
            const totalPlugins = window.pluginData.length;
            const totalRepos = new Set(window.pluginData.map(plugin => plugin.repositoryUrl)).size;
            let selectedRepoCount = 0;

            if (selectedRepo !== "all") {
                const selectedPlugin = window.pluginData.find(plugin => plugin.repositoryUrl === selectedRepo);
                selectedRepoCount = window.pluginData.filter(plugin => plugin.repositoryUrl === selectedRepo).length;
                document.getElementById("statsContainer").innerHTML = `
                    <span style="font-weight: bold;">Depo Kodu: ${selectedPlugin?.repoCode || "Bilinmiyor"}</span> | 
                    <span style="font-weight: bold;">Bu Depodaki Eklenti Sayısı: ${selectedRepoCount}</span>
                `;
            } else {
                document.getElementById("statsContainer").innerHTML = `
                    <span>Toplam Eklenti: ${totalPlugins}</span> | 
                    <span>Toplam Depo: ${totalRepos}</span>
                `;
            }
        }

        function updateFilterOptions() {
            const filterSelect = document.getElementById("filterSelect");
            let mediaTypes = new Set();
            window.pluginData.forEach(plugin => plugin.tvTypes.forEach(type => mediaTypes.add(type)));

            filterSelect.innerHTML = '<option value="all">Tüm Eklentiler</option>';
            mediaTypes.forEach(type => {
                let option = document.createElement("option");
                option.value = type;
                option.textContent = type;
                filterSelect.appendChild(option);
            });
        }

        function updateRepoOptions() {
            const repoFilterSelect = document.getElementById("repoFilterSelect");
            let repositories = new Set();
            let repoNames = new Map();
            
            window.pluginData.forEach(plugin => {
                repositories.add(plugin.repositoryUrl);
                if (plugin.repoCode) {
                    repoNames.set(plugin.repositoryUrl, plugin.repoCode);
                }
            });

            repoFilterSelect.innerHTML = '<option value="all">Tüm Depolar</option>';
            repositories.forEach(repo => {
                let option = document.createElement("option");
                option.value = repo;
                option.textContent = repoNames.get(repo) || "Bilinmiyor";
                repoFilterSelect.appendChild(option);
            });
        }

        function updateTable(filterType, repoFilter, searchQuery) {
    const tableBody = document.querySelector("#pluginTable tbody");
    tableBody.innerHTML = "";

    window.pluginData.forEach(plugin => {
        if (filterType !== "all" && !plugin.tvTypes.includes(filterType)) return;
        if (repoFilter !== "all" && !plugin.repoCodes.includes(repoFilter)) return;
        if (searchQuery && !plugin.name.toLowerCase().includes(searchQuery.toLowerCase())) return;

        // Eğer repoCodes tanımlı değilse boş bir dizi ata
        const repoCodesFormatted = (plugin.repoCodes && plugin.repoCodes.length) ? plugin.repoCodes.join(" / ") : "Bilinmiyor";

        const row = document.createElement("tr");
        row.innerHTML = `
            <td><img src="${plugin.iconUrl.replace('%size%', '64')}" width="32"></td>
            <td>${plugin.name}</td>
            <td>${plugin.version}</td>
            <td>${plugin.language}</td>
            <td>${repoCodesFormatted}</td> <!-- Depo kodlarını birleştirme -->
            <td>${plugin.tvTypes.join(", ")}</td>
            <td>${plugin.description || "Açıklama Yok"}</td>
        `;
        tableBody.appendChild(row);
    });
}



        // Event Listener'ları ekleyelim
        document.getElementById("filterSelect").addEventListener("change", function() {
            const repoFilter = document.getElementById("repoFilterSelect").value;
            const searchQuery = document.getElementById("searchInput").value;
            updateTable(this.value, repoFilter, searchQuery);
        });

        document.getElementById("repoFilterSelect").addEventListener("change", function() {
            const filterType = document.getElementById("filterSelect").value;
            const searchQuery = document.getElementById("searchInput").value;
            updateStats(this.value);
            updateTable(filterType, this.value, searchQuery);
        });

        document.getElementById("searchInput").addEventListener("input", function() {
            const filterType = document.getElementById("filterSelect").value;
            const repoFilter = document.getElementById("repoFilterSelect").value;
            updateTable(filterType, repoFilter, this.value);
        });

        document.getElementById("clearSearch").addEventListener("click", function() {
            document.getElementById("searchInput").value = "";
            const filterType = document.getElementById("filterSelect").value;
            const repoFilter = document.getElementById("repoFilterSelect").value;
            updateTable(filterType, repoFilter, "");
        });

        fetchPlugins();
    </script>
</body>
</html>
